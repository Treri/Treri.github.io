<!DOCTYPE html>
<html id="J-html" class="">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>在使用 JS 的项目中使用 ESLint 强制进行 code style check | 自说Me话</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="在使用 JS 的项目中使用 ESLint 强制进行 code style check" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="code style 是一个经常被大家提起的东西. 当项目中人少的时候, 大家一般都能有一个约定, 并去遵守." />
<meta property="og:description" content="code style 是一个经常被大家提起的东西. 当项目中人少的时候, 大家一般都能有一个约定, 并去遵守." />
<link rel="canonical" href="http://isay.me/2016/05/use-eslint-force-code-style-check.html" />
<meta property="og:url" content="http://isay.me/2016/05/use-eslint-force-code-style-check.html" />
<meta property="og:site_name" content="自说Me话" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-13T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="在使用 JS 的项目中使用 ESLint 强制进行 code style check" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2016-05-13T00:00:00+08:00","datePublished":"2016-05-13T00:00:00+08:00","description":"code style 是一个经常被大家提起的东西. 当项目中人少的时候, 大家一般都能有一个约定, 并去遵守.","headline":"在使用 JS 的项目中使用 ESLint 强制进行 code style check","mainEntityOfPage":{"@type":"WebPage","@id":"http://isay.me/2016/05/use-eslint-force-code-style-check.html"},"url":"http://isay.me/2016/05/use-eslint-force-code-style-check.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="http://isay.me/feed.xml" title="自说Me话" />
  <link rel="stylesheet" type="text/css" media="all" href="/assets/css/style.css" />
  
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
  
  <nav class="lotus-nav">
  <ul>
    
    
    
    
    
    <li class="home ">
      
      <a href="/" rel="bookmark" title="首页">
        <i class="fa fa-home"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/archives.html" rel="bookmark" title="文章归档">
        <i class="fa fa-reorder"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/tags.html" rel="bookmark" title="文章标签">
        <i class="fa fa-tags"></i>
      </a>
      
    </li>
    

    
    
    
    
    
    <li class=" ">
      
      <a href="/contact.html" rel="bookmark" title="关于我">
        <i class="fa fa-user"></i>
      </a>
      
    </li>
    
  </ul>
</nav>

  <p class="lotus-breadcrub">
  <a href="/" rel="nofollow" rel="nofollow" title="首页">首页</a>
  <span> &gt; </span>
  <a href="/archives.html" rel="nofollow" >文章归档</a>
  <span> &gt; </span>
  在使用 JS 的项目中使用 ESLint 强制进行 code style check
</p>
<h1 class="lotus-pagetit">在使用 JS 的项目中使用 ESLint 强制进行 code style check</h1>
<p class="lotus-meta">Publish: <time class="date" pubdate="May 13, 2016">May 13, 2016</time></p>
<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>code style 是一个经常被大家提起的东西. 当项目中人少的时候, 大家一般都能有一个约定, 并去遵守.</p>

<p>但是当项目变大, 或者有新的开发人员加入进来的时候, code style 不一致的问题就会变大. 甚至有些写法不规范的地方, 导致看代码的时候感觉不舒服.
假如每个人喜欢的风格不一致, 当编辑代码的时候, 又使用了代码自动格式化工具按照自己的喜好进行格式化, 那么当提交到 git 的时候, 会出现全红全绿的情况, 特别不利于 review.</p>

<p>因此应该采取一种手段进行约束.</p>

<p>所以我采用了 git hook 的方式在本地强制进行 code style check. 当 check fail 时, 直接拒绝 commit. 防止出现为了修复 code style 而添加的一些意义不大的 commit.</p>

<ol>
  <li>项目安装 ESLint, 并配置 <code class="language-plaintext highlighter-rouge">eslintrc</code> 和 <code class="language-plaintext highlighter-rouge">eslintignore</code></li>
  <li>
    <p>在项目的 <code class="language-plaintext highlighter-rouge">.git-hooks</code> 目录下添加如下脚本, 来源 https://gist.github.com/linhmtran168/2286aeafe747e78f53bf</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="nv">STAGED_FILES</span><span class="o">=</span><span class="si">$(</span>git diff <span class="nt">--cached</span> <span class="nt">--name-only</span> <span class="nt">--diff-filter</span><span class="o">=</span>ACM | <span class="nb">grep</span> <span class="s2">".jsx</span><span class="se">\{</span><span class="s2">0,1</span><span class="se">\}</span><span class="s2">$"</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$STAGED_FILES</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">exit </span>0
<span class="k">fi</span>

<span class="c"># Check for eslint</span>
<span class="nv">ESLINT</span><span class="o">=</span><span class="s2">"./node_modules/.bin/eslint"</span>
<span class="k">if</span> <span class="o">[[</span> <span class="o">!</span> <span class="nt">-e</span> <span class="nv">$ESLINT</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">""</span>
  <span class="nb">echo</span> <span class="s2">"  </span><span class="se">\0</span><span class="s2">33[41mPlease use &lt;npm install&gt; to install ESlint</span><span class="se">\0</span><span class="s2">33[0m"</span>
  <span class="nb">exit </span>1
<span class="k">fi</span><span class="p">;</span>

<span class="nv">PASS</span><span class="o">=</span><span class="nb">true
echo</span> <span class="s2">""</span>

<span class="k">for </span>FILE <span class="k">in</span> <span class="nv">$STAGED_FILES</span>
<span class="k">do</span>
  <span class="nv">$ESLINT</span> <span class="s2">"</span><span class="nv">$FILE</span><span class="s2">"</span>

  <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> <span class="o">==</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"  </span><span class="se">\0</span><span class="s2">33[32mESLint Passed: </span><span class="nv">$FILE</span><span class="se">\0</span><span class="s2">33[0m"</span>
  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"  </span><span class="se">\0</span><span class="s2">33[41mESLint Failed: </span><span class="nv">$FILE</span><span class="se">\0</span><span class="s2">33[0m"</span>
    <span class="nv">PASS</span><span class="o">=</span><span class="nb">false
  </span><span class="k">fi
done

if</span> <span class="o">!</span> <span class="nv">$PASS</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"</span><span class="se">\n\0</span><span class="s2">33[41mCOMMIT FAILED:</span><span class="se">\0</span><span class="s2">33[0m Your commit contains files that should pass ESLint but do not. Please fix the ESLint errors and try again.</span><span class="se">\n</span><span class="s2">"</span>
  <span class="nb">exit </span>1
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"</span><span class="se">\n\0</span><span class="s2">33[42mCOMMIT SUCCEEDED</span><span class="se">\0</span><span class="s2">33[0m</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">fi

</span><span class="nb">exit</span> <span class="nv">$?</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>在 <code class="language-plaintext highlighter-rouge">package.json</code> 中进行配置 <code class="language-plaintext highlighter-rouge">postinstall</code> 为如下内容</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> .git-hooks/<span class="k">*</span> .git/hooks/
</code></pre></div>    </div>
  </li>
</ol>

<p>这样, 每次 npm install 之后, 都会将检查脚本放置到正确的位置. 每次 git commit 的时候, 都会进行 code style check.</p>

<p>我们目前的项目中, 使用了 FIS3 进行开发, 所以我们开发时, 会有对应的 <code class="language-plaintext highlighter-rouge">npm run dev</code> 这样的 script, 为了确保检查脚本能被正确放置, 我在 <code class="language-plaintext highlighter-rouge">npm run dev</code> 中也会去跑一遍 <code class="language-plaintext highlighter-rouge">npm run postinstall</code>.
这样, 就不会出现, 由于原来已经 npm install 过了, 而没有把检查脚本正确放置的情况.</p>

</article>
<p class="lotus-anno">声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="自由转载-非商用-非衍生-保持署名">BY-NC-SA</a> 授权。转载请注明转自: <a href="http://isay.me/2016/05/use-eslint-force-code-style-check.html" title="" rel="nofollow">在使用 JS 的项目中使用 ESLint 强制进行 code style check - 自说Me话</a></p>
<section class="lotus-nextpage fn-clear">
  
  <div class="lotus-nextpage-left"><a class="prev" href="/2016/04/use-systemjs-as-es6-loader.html" rel="prev">&laquo;&nbsp;使用 System.js 作为 ES6 的加载器...</a></div>
  
  
  <div class="lotus-nextpage-right"><a class="next" href="/2017/03/migrate-duoshuo-to-disqus.html" rel="next">将多说评论系统迁移到Disqus&nbsp;&raquo;</a></div>
  
</section>


  <div id="comments">
  
      
        <div id="disqus_thread"></div>
<script>
  function disqus_config() {
      this.page.url = "http://isay.me/2016/05/use-eslint-force-code-style-check.html";
      this.page.identifier = "2016051301";
      this.page.title = "在使用 JS 的项目中使用 ESLint 强制进行 code style check";
  };

  (function() {
      var d = document, s = d.createElement('script');
      s.src = '//isaymesite.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      
  
  </div>




  <footer class="lotus-footer">
  <p>Copyright © 2011–2023 自说Me话 All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
  
</body>
</html>
