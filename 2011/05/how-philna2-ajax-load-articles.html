<!DOCTYPE html>
<html id="J-html" class="">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PhilNa2首页Ajax加载文章 | 自说Me话</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="PhilNa2首页Ajax加载文章" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="前几天弄出来的东西,没用几天就换主题了, :jiong: 但是还是和大家分享一下.免得时间长了,我自己也忘记了." />
<meta property="og:description" content="前几天弄出来的东西,没用几天就换主题了, :jiong: 但是还是和大家分享一下.免得时间长了,我自己也忘记了." />
<link rel="canonical" href="http://isay.me/2011/05/how-philna2-ajax-load-articles.html" />
<meta property="og:url" content="http://isay.me/2011/05/how-philna2-ajax-load-articles.html" />
<meta property="og:site_name" content="自说Me话" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-05-20T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PhilNa2首页Ajax加载文章" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-05-20T00:00:00+08:00","datePublished":"2011-05-20T00:00:00+08:00","description":"前几天弄出来的东西,没用几天就换主题了, :jiong: 但是还是和大家分享一下.免得时间长了,我自己也忘记了.","headline":"PhilNa2首页Ajax加载文章","mainEntityOfPage":{"@type":"WebPage","@id":"http://isay.me/2011/05/how-philna2-ajax-load-articles.html"},"url":"http://isay.me/2011/05/how-philna2-ajax-load-articles.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="http://isay.me/feed.xml" title="自说Me话" />
  <link rel="stylesheet" type="text/css" media="all" href="/assets/css/style.css" />
  
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
  
  <nav class="lotus-nav">
  <ul>
    
    
    
    
    
    <li class="home ">
      
      <a href="/" rel="bookmark" title="首页">
        <i class="fa fa-home"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/archives.html" rel="bookmark" title="文章归档">
        <i class="fa fa-reorder"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/tags.html" rel="bookmark" title="文章标签">
        <i class="fa fa-tags"></i>
      </a>
      
    </li>
    

    
    
    
    
    
    <li class=" ">
      
      <a href="/contact.html" rel="bookmark" title="关于我">
        <i class="fa fa-user"></i>
      </a>
      
    </li>
    
  </ul>
</nav>

  <p class="lotus-breadcrub">
  <a href="/" rel="nofollow" rel="nofollow" title="首页">首页</a>
  <span> &gt; </span>
  <a href="/archives.html" rel="nofollow" >文章归档</a>
  <span> &gt; </span>
  PhilNa2首页Ajax加载文章
</p>
<h1 class="lotus-pagetit">PhilNa2首页Ajax加载文章</h1>
<p class="lotus-meta">Publish: <time class="date" pubdate="May 20, 2011">May 20, 2011</time></p>
<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>前几天弄出来的东西,没用几天就换主题了, :jiong: 但是还是和大家分享一下.免得时间长了,我自己也忘记了.</p>

<p>php响应部分代码来源于 木木的文章<a href="http://immmmm.com/ajax-loading-post-content.html">AJAX动态加载文章内容</a>
响应部分的修改来自winysky<a href="http://winysky.com/query_posts-automatic-cut-off">Query_posts之自动截断</a></p>

<p><strong>首先</strong>是php响应部分,将如下代码放到functions.php里面,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function ajax_post(){
if( isset($_GET['action'])&amp;&amp; $_GET['action'] == 'ajax_post'){
$ariticle_id=$_GET['id'];
query_posts("p=$ariticle_id");
the_post();
global $more;
$more = 0;
 the_content(__('Read more...', YHL)); //此处可以输出more标签之前的内容
die();
}else{
return;
}
}
add_action('init', 'ajax_post');
</code></pre></div></div>

<p><strong>然后</strong>是jQuery的AJAX代码(<strong>我已经修改过了,PhilNa2可以直接拿来用,不需要修改</strong>)
jquery代码部分 框架 来源于木木的文章,部分代码来自<a href="http://loosky.net">自由的风</a>博客,这里一并表示感谢.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//AJAX动态加载文章内容 By ISayMe.com
$('#content .post_title').click(function() {//文章标题点击事件
	var postContent = $(this).next().next();
	var id = $(this).parent().attr("id");
	var postId = id.replace(/^post-(.*)$/, '$1');//获取文章ID
	if (postContent.html() == "") {//如果文章内容为空，则执行以下代码
		$.ajax({
			url: "?action=ajax_post&amp;id=" + postId,
			beforeSend: function() {
				$('#content .post_content').slideUp(150,
				function() {
					postContent.html('&lt;p class="ajaxloading"&gt;Loading......&lt;/p&gt;').show()
				});
			},
			success: function(data) {
				postContent.hide(0).html(data).slideDown(500,
				function() {
					$body.animate({
						scrollTop: $(this).offset().top - 180
					},
					500)
				});
			}
		});
		return false;
	} else if (postContent.is(":hidden")) {//如果文章内容为隐藏，则执行以下代码
		$('#content .post_content').slideUp(500);
		postContent.slideDown(500,
		function() {
			$body.animate({
				scrollTop: $(this).offset().top - 180
			},
			400)
		});
		return false;
	} else {//如果文章内容为显示，执行以下代码
		$(this).children('a').text('页面载入中……');//改变文章标题文字
		window.location = $(this).children().attr('href');//打开文章链接
	}
});
$('#content .post_content:first').slideDown(500); //自动展开第一篇文章,此处不需要,这个是文章伸缩时的代码
</code></pre></div></div>

<p>对于php文件还需要再修改一下. 修改来源取自 自由的风 主题<strong>loosky</strong>,再次表示感谢.</p>

<p><strong>loop.php</strong>文件.在头部的作者声明信息下面寻找如下内容</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if( have_posts() ) :
	// post loop start
	do_action('philnaLoopStart'); /* philna hook */ //在此行下方添加内容,
	while( have_posts() ) :
	the_post();, 修改后代码如下,这是为了计数用的,只让指定篇数的文章显示内容,其余的不加载.

if( have_posts() ) :
	// post loop start
	do_action('philnaLoopStart'); /* philna hook */
        $count=1;
	while( have_posts() ) :
	the_post(); 找到

&lt;div class="post_content content"&gt; 将如下内容全部删掉

&lt;?php
		// if the post has thumbnail, display it in homepage or archive page
		if((is_home() || is_archive()) &amp;&amp; has_post_thumbnail()) {
			the_post_thumbnail(); // you may change the size of the thumbnail by use param array(width, height);
		}
		the_content(__('Read more...', YHL));
		?&gt;
&lt;div class="clear"&gt;&lt;/div&gt; 同时将空格换行什么的都全部删掉(关键!!要不然无法ajax加载成功)变成如下这样的样式(以下是为了向你展示一下无空格换行之后结果)

&lt;div class="post_content content"&gt;&lt;?php if( is_singular() ) wp_link_pages('before=&lt;div class="content_pages icon"&gt;&lt;strong&gt;'. __('Pages:', YHL).'&amp;after=&lt;/strong&gt;&lt;/div&gt;'); ?&gt; 的后面添加如下内容

&lt;?php
	if(is_bot() || is_single()) : the_content();
	elseif($count &gt;=1 &amp;&amp;$count &lt;=1) :the_content(__('Read more...', YHL));
	endif;
	$count++;?&gt; 修改后如下(php函数中出现换行空格神马的没事.)

&lt;div class="post_content content"&gt;&lt;?php
	if(is_bot() || is_single()) : the_content();
	elseif($count &gt;=1 &amp;&amp;$count &lt;=1) :the_content(__('Read more...', YHL));
	endif;
	$count++;?&gt;&lt;?php if( is_singular() ) wp_link_pages('before=&lt;div class="content_pages icon"&gt;&lt;strong&gt;'. __('Pages:', YHL).'&amp;after=&lt;/strong&gt;&lt;/div&gt;'); ?&gt;
</code></pre></div></div>

<p>那个count的数字是定义输出文章的篇数,我原来用了一篇,其他的全部ajax加载.</p>

<p>这样就OK了.有问题了再来问我吧</p>

</article>
<p class="lotus-anno">声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="自由转载-非商用-非衍生-保持署名">BY-NC-SA</a> 授权。转载请注明转自: <a href="http://isay.me/2011/05/how-philna2-ajax-load-articles.html" title="" rel="nofollow">PhilNa2首页Ajax加载文章 - 自说Me话</a></p>
<section class="lotus-nextpage fn-clear">
  
  <div class="lotus-nextpage-left"><a class="prev" href="/2011/05/dont-know-reload-js-function.html" rel="prev">&laquo;&nbsp;js函数重新加载,不会~</a></div>
  
  
  <div class="lotus-nextpage-right"><a class="next" href="/2011/05/note-about-optimize-blog.html" rel="next">博客优化小记&nbsp;&raquo;</a></div>
  
</section>


  <div id="comments">
  
      
        <div id="disqus_thread"></div>
<script>
  function disqus_config() {
      this.page.url = "http://isay.me/2011/05/how-philna2-ajax-load-articles.html";
      this.page.identifier = "141";
      this.page.title = "PhilNa2首页Ajax加载文章";
  };

  (function() {
      var d = document, s = d.createElement('script');
      s.src = '//isaymesite.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      
  
  </div>




  <footer class="lotus-footer">
  <p>Copyright © 2011–2023 自说Me话 All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
  
</body>
</html>
