<!DOCTYPE html>
<html id="J-html" class="">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PhilNa2-侧栏去掉博主回复 | 自说Me话</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="PhilNa2-侧栏去掉博主回复" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="没事乱折腾的.说不定哪天就换回去了.但是弄出来东西还是想和大家分享一下,刚用这个主题的时候一心想着怎么把侧边栏的博主回复去掉,但是不会,也没找到方法. 时间长了,感觉侧栏有博主的回复也挺好的." />
<meta property="og:description" content="没事乱折腾的.说不定哪天就换回去了.但是弄出来东西还是想和大家分享一下,刚用这个主题的时候一心想着怎么把侧边栏的博主回复去掉,但是不会,也没找到方法. 时间长了,感觉侧栏有博主的回复也挺好的." />
<link rel="canonical" href="http://isay.me/2011/05/remove-sidebar-admin-respond.html" />
<meta property="og:url" content="http://isay.me/2011/05/remove-sidebar-admin-respond.html" />
<meta property="og:site_name" content="自说Me话" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-05-12T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PhilNa2-侧栏去掉博主回复" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-05-12T00:00:00+08:00","datePublished":"2011-05-12T00:00:00+08:00","description":"没事乱折腾的.说不定哪天就换回去了.但是弄出来东西还是想和大家分享一下,刚用这个主题的时候一心想着怎么把侧边栏的博主回复去掉,但是不会,也没找到方法. 时间长了,感觉侧栏有博主的回复也挺好的.","headline":"PhilNa2-侧栏去掉博主回复","mainEntityOfPage":{"@type":"WebPage","@id":"http://isay.me/2011/05/remove-sidebar-admin-respond.html"},"url":"http://isay.me/2011/05/remove-sidebar-admin-respond.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="http://isay.me/feed.xml" title="自说Me话" />
  <link rel="stylesheet" type="text/css" media="all" href="/assets/css/style.css" />
  
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
  
  <nav class="lotus-nav">
  <ul>
    
    
    
    
    
    <li class="home ">
      
      <a href="/" rel="bookmark" title="首页">
        <i class="fa fa-home"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/archives.html" rel="bookmark" title="文章归档">
        <i class="fa fa-reorder"></i>
      </a>
      
    </li>
    
    
    
    
    
    <li class=" ">
      
      <a href="/tags.html" rel="bookmark" title="文章标签">
        <i class="fa fa-tags"></i>
      </a>
      
    </li>
    

    
    
    
    
    
    <li class=" ">
      
      <a href="/contact.html" rel="bookmark" title="关于我">
        <i class="fa fa-user"></i>
      </a>
      
    </li>
    
  </ul>
</nav>

  <p class="lotus-breadcrub">
  <a href="/" rel="nofollow" rel="nofollow" title="首页">首页</a>
  <span> &gt; </span>
  <a href="/archives.html" rel="nofollow" >文章归档</a>
  <span> &gt; </span>
  PhilNa2-侧栏去掉博主回复
</p>
<h1 class="lotus-pagetit">PhilNa2-侧栏去掉博主回复</h1>
<p class="lotus-meta">Publish: <time class="date" pubdate="May 12, 2011">May 12, 2011</time></p>
<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>没事乱折腾的.说不定哪天就换回去了.但是弄出来东西还是想和大家分享一下,刚用这个主题的时候一心想着怎么把侧边栏的博主回复去掉,但是不会,也没找到方法.
时间长了,感觉侧栏有博主的回复也挺好的.</p>

<p>去掉博主回复这个也是无意间鼓捣的.
效果图如下所示</p>

<p><img src="/uploads/2011/05/12_01.png" alt="" /></p>

<p>在本地的wordpress乱翻那些php文件,就翻到了app/recentcomments.php文件.然后打开看了看.网上好多人侧栏去掉博主评论都是用的那种直接从数据库中读取评论时不读取mail等于博主邮箱的评论.但是philna2主题不是用的直接从数据库中读取,而是使用了wp官方的get_comments()函数.</p>

<p>我在zww大大的文章中才知道”WordPress官方一直不推荐直接用SQL语言调用数据库数据，所以一直以来WordPress官方主题审核中，直接用SQL语句的代码是通不过审核的”.可见philna2主题作者yinheli的细心.呵呵.</p>

<p>此文的修改灵感,来自zww大大的<a href="http://zww.me/archives/25317">用get_comments()函数实现带头像最新评论</a>
在我的googlereader里面放了好长时间.当我看到此主题是用的get_comments()函数时我才想起来我看过这样一篇文章.所以就拿来看看了,还真改出来了.</p>

<p>在zww的文章中,排除博主的回复用到的方法大致如下,先用get_comments()函数从数据库中取出N条评论,这其中包括了博主的回复.然后遍历这些评论.把其中的博主回复去掉.当到达指定的条数时停止遍历,然后输出.
<strong>以上是我的理解,可能有偏颇,希望大家指教.</strong></p>

<p>我看到philna2主题中最新评论的函数写法和zww的那篇文章中的函数有相似的地方.所以就修改了一下.指定输出的条数.然后去掉博主的回复.修改的过程不说了,我不会表达.直接贴出来吧.把我的recentcomments.php文件的内容全部贴出来.自己看着修改自己的.或者直接复制粘贴也行
(<strong>为了不把文章拉的过长,我把头部的主题作者的信息和注释去掉了</strong>)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// no direct access
defined('PHILNA') or die('Restricted access -- PhilNa2 gorgeous design by yinheli &lt; http://philna.com/ &gt;');
function philnaRecentcomments($args='number=20&amp;status=approve'){
	$cacheID = md5($args);
	if($output = wp_cache_get('recentComments_'.$cacheID, 'philna')){
		echo $output;
		return;
	}
	$rcms = get_comments($args);
	//print_r($rcms);return;
	if(empty($rcms)){
		_e('No Data Found',YHL);
		return;
	}
	$show_comments = 7;//指定输出条数
	$my_email = get_bloginfo ('admin_email'); //获取博主自己的email
	$i = 0;//计数器
	//历遍数据
	$output = '';
	foreach( $rcms as $rcm ){
		// 如果访客昵称为空, 则将显示名字设为 "Anonymous"
		if($rcm-&gt;comment_author_email != $my_email ){
		$i++;
		$author = $rcm-&gt;comment_author ? $rcm-&gt;comment_author : __('Anonymous', YHL);
		$content = philnaStriptags( $rcm-&gt;comment_content);
		$l_excerpt = philnaSubstr( $content, 200 );
		$l_excerpt = preg_replace('/["']/', '', $l_excerpt);
		$s_excerpt = convert_smilies( philnaSubstr( $content, 30 ) );
		$comment_author_link = '&lt;a class="no_webshot" href="'.get_comment_link($rcm).'" rel="external nofollow" title="'.$l_excerpt.'"&gt;'.$author.'&lt;/a&gt;';
		if($rcm-&gt;comment_type == ''){
			$output .= '&lt;li class="r_item"&gt;&lt;div class="row"&gt;'.get_avatar($rcm-&gt;comment_author_email, 25).'&lt;span class="r_name"&gt;'.$comment_author_link.'&lt;/span&gt;&lt;br /&gt;&lt;span class="r_excerpt"&gt;'.$s_excerpt.'&lt;/span&gt;&lt;/div&gt;&lt;div class="clear"&gt;&lt;/div&gt;&lt;/li&gt;'."n";//不想分两行的话.将br和尖括号去掉
		}elseif($rcm-&gt;comment_type == 'pingback'){
			$output .= '&lt;li class="r_item r_pingback"&gt;&lt;span class="rc_label name"&gt;' . __('Pingback:') . '&lt;/span&gt;'.$comment_author_link.'&lt;/li&gt;';
		}elseif($rcm-&gt;comment_type == 'trackback'){
			$output .= '&lt;li class="r_item r_traback"&gt;&lt;span class="rc_label name"&gt;' . __('Trackback:') . '&lt;/span&gt;'.$comment_author_link.'&lt;/li&gt;';
		}
		}
		if ($i == $show_comments) break;
	}
	wp_cache_add('recentComments_'.$cacheID. $output, 'philna');
	echo $output;
}
</code></pre></div></div>

<p>我在评论里面将评论者还有评论内容分成两行了.不想分两行的话,就把$rcm-&gt;comment_type == ‘‘的那个输出中的回车符&lt; br&gt;去掉就行了
另外我把评论者头像放大了.原来是20px,现在是25px,自己看着修改吧</p>

<p>使用这个方法的时候最好将侧边栏调用函数的<strong>philnaRecentcomments($args=’number=6&amp;status=approve’)</strong>中的那个数字调大点.因为如果太小的话,取出来的评论可能去掉博主回复之后,就不够你指定的输出条数了.zww那个文章里面写的是200……我写的是15</p>

</article>
<p class="lotus-anno">声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="自由转载-非商用-非衍生-保持署名">BY-NC-SA</a> 授权。转载请注明转自: <a href="http://isay.me/2011/05/remove-sidebar-admin-respond.html" title="" rel="nofollow">PhilNa2-侧栏去掉博主回复 - 自说Me话</a></p>
<section class="lotus-nextpage fn-clear">
  
  <div class="lotus-nextpage-left"><a class="prev" href="/2011/05/shortcode-enable-mp3player.html" rel="prev">&laquo;&nbsp;短代码 mp3player</a></div>
  
  
  <div class="lotus-nextpage-right"><a class="next" href="/2011/05/feed-add-comment-num.html" rel="next">给feed输出 添加评论条数&nbsp;&raquo;</a></div>
  
</section>


  <div id="comments">
  
      
        <div id="disqus_thread"></div>
<script>
  function disqus_config() {
      this.page.url = "http://isay.me/2011/05/remove-sidebar-admin-respond.html";
      this.page.identifier = "129";
      this.page.title = "PhilNa2-侧栏去掉博主回复";
  };

  (function() {
      var d = document, s = d.createElement('script');
      s.src = '//isaymesite.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      
  
  </div>




  <footer class="lotus-footer">
  <p>Copyright © 2011–2023 自说Me话 All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
  
</body>
</html>
